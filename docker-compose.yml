services:
  db:
    image: postgres:alpine
    container_name: peluqueria-db
    environment:
      POSTGRES_DB: peluqueria_marzetti
      POSTGRES_USER: ${DB_USERNAME}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: peluqueria-backend:latest
    container_name: peluqueria-backend
    working_dir: /app
    restart: unless-stopped
    depends_on:
      - db
    environment:
      SERVER_PORT: ${SERVER_PORT:-8080}
      DB_URL: ${DB_URL}
      DB_USERNAME: ${DB_USERNAME}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_DRIVER: ${DB_DRIVER:-org.postgresql.Driver}
      JWT_SECRET: ${JWT_SECRET}
      JWT_EXPIRATION: ${JWT_EXPIRATION:-86400000}
      MERCADOPAGO_ACCESS_TOKEN: ${MERCADOPAGO_ACCESS_TOKEN}
      MERCADOPAGO_PUBLIC_KEY: ${MERCADOPAGO_PUBLIC_KEY}
      API_DOCS_PATH: ${API_DOCS_PATH:-/api-docs}
      SWAGGER_UI_PATH: ${SWAGGER_UI_PATH:-/swagger-ui.html}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS}

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_URL: ${VITE_API_URL:-/api}
    image: peluqueria-frontend:latest
    container_name: peluqueria-frontend
    restart: unless-stopped
    depends_on:
      - backend

  nginx:
    image: nginx:alpine
    container_name: peluqueria-nginx
    depends_on:
      - backend
      - frontend
    ports:
      - "8083:80"
    volumes:
      - ./nginx-full.conf:/etc/nginx/nginx.conf:ro
    restart: unless-stopped

volumes:
  postgres_data:
